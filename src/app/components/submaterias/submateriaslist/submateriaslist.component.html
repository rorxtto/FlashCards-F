<br>
<div class="container">
    <div class="row">
        <div class="col-lg-12">

            <div class="card">
                
                
                <div class="card-body">
                    <h1 style="text-align: center;"> Listagem de SubMaterias </h1>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            @if (esconderBotoes){}
                            @else {
                                <button type="button" class="btn btn-primary btn-rounded mb-2" mdbRipple (click)="new()" routerLinkActive="router-link-active" >Novo +</button>
                                <button type="button" class="btn btn-success btn-rounded mb-2 ms-2" mdbRipple (click)="materiasList()" routerLinkActive="router-link-active" > <- Matérias</button>
                            }
                        </div>
                        <div class="col-md-6">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Pesquisar por nome..." 
                                    [(ngModel)]="filtroNome" (keyup)="onSearch()">
                                <button class="btn btn-outline-primary" type="button" (click)="onSearch()">Buscar</button>
                                <button class="btn btn-outline-secondary" type="button" (click)="limparFiltros()" 
                                    [disabled]="!filtroNome">Limpar</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Opções de tamanho da página -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="pageSize">Itens por página:</label>
                                <select class="form-select form-select-sm" id="pageSize" [(ngModel)]="pageSize" (change)="changePageSize()">
                                    @for (size of pageSizeOptions; track $index) {
                                        <option [value]="size">{{ size }}</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-md-8 text-end">
                            <span>Mostrando {{ lista.length }} de {{ totalItems }} submaterias</span>
                        </div>
                    </div>

                    <!-- Indicador de carregamento -->
                    @if (carregando) {
                        <div class="text-center my-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando...</span>
                            </div>
                            <p class="mt-2">Carregando submaterias...</p>
                        </div>
                    }

                    <!-- Tabela de submaterias -->
                    @if (!carregando && lista.length > 0) {
                        <div class="table-responsive">
                            <table border=1 class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Id</th>
                                        <th>Nome</th>
                                        <th>Matéria</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    @for (submateria of lista; track submateria.id) {
                                        <tr>
                                            <td>{{ submateria.id }}</td>
                                            <td>{{ submateria.nome }}</td>
                                            <td>
                                                @if (submateria.materia) {
                                                    {{ submateria.materia.nome }}
                                                } @else {
                                                    <span class="text-muted">Não há matéria vinculada</span>
                                                }
                                            </td>
                                            <td>
                                                @if (esconderBotoes) {
                                                    <button type="button" class="btn btn-sm btn-primary" mdbRipple (click)="select(submateria)">Selecionar</button>
                                                } @else {
                                                    <div class="btn-group">
                                                        <button type="button" class="btn btn-sm btn-primary" mdbRipple (click)="edit(submateria)">Editar</button>
                                                        <button type="button" class="btn btn-sm btn-danger ms-1" mdbRipple (click)="deleteById(submateria)">Deletar</button>
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    } @else if (!carregando && lista.length === 0) {
                        <div class="alert alert-info text-center">
                            Nenhuma submatéria encontrada.
                        </div>
                    }

                    <!-- Controles de Paginação Otimizados -->
                    @if (totalPages > 0) {
                        <div class="d-flex justify-content-center mt-3">
                            <nav>
                                <ul class="pagination">
                                    <!-- Botão Primeira Página -->
                                    <li class="page-item" [class.disabled]="currentPage === 0">
                                        <a class="page-link" (click)="goToPage(0)" aria-label="Primeira">
                                            <span aria-hidden="true">&laquo;&laquo;</span>
                                        </a>
                                    </li>
                                    
                                    <!-- Botão Anterior -->
                                    <li class="page-item" [class.disabled]="currentPage === 0">
                                        <a class="page-link" (click)="prevPage()" aria-label="Anterior">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    
                                    <!-- Números de Página Dinâmicos -->
                                    @for (page of getPagesArray(); track $index) {
                                        <li class="page-item" [class.active]="currentPage === page">
                                            <a class="page-link" (click)="goToPage(page)">{{ page + 1 }}</a>
                                        </li>
                                    }
                                    
                                    <!-- Botão Próximo -->
                                    <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
                                        <a class="page-link" (click)="nextPage()" aria-label="Próximo">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                    
                                    <!-- Botão Última Página -->
                                    <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
                                        <a class="page-link" (click)="goToPage(totalPages - 1)" aria-label="Última">
                                            <span aria-hidden="true">&raquo;&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #modalSubmateriaDetalhe>
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Cadastro SubMatérias</h5>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="modalRef.close()"
        ></button>
      </div>
      <div class="modal-body">
        <app-submateriasdetails [submateria]="submateriaEdit" (retorno)="retornoDetalhe($event)"></app-submateriasdetails>
      </div>
</ng-template>